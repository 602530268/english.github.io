---
layout: mypost
title: JSP
date:   2019-12-29 23:38:00
categories: [JSP]
---

上传:

```
 	<p>请选择要上传的文件</p>
  	<form action="" method="post" name="form" enctype="multipart/form-data">
  		<input type="file" name="boy" size="38">
  		<br><input type="submit" name="g" value="提交">
  	</form>
  	<%
  		try{
  			InputStream in=request.getInputStream();
  			File dir=new File("D:\\MyEclipse-Workspaces\\2000");
  			dir.mkdir();
	  		File f=new File(dir,"b.txt");
	  		FileOutputStream o=new FileOutputStream(f);
	  		byte b[]=new byte[1000];
	  		int n;
	  		while((n=in.read(b))!=-1)
	  			o.write(b, 0, n);
	  		o.close();
	  		in.close();
	  		out.print("文件已上传");
  		}catch(Exception e){
  			out.print("文件上传失败"+e);
  		}
  	 %>
```

下载:

```
  	<form action="Load1.jsp" method="post" name="form">
  		<p>请选择你要下载的文件</p>
  		<select name="filePath" size="3">
  			<option value="D:/MyEclipse-Workspaces/1000/2.txt">D:\MyEclipse-Workspaces\1000\2.txt</option>
  			<option value="D:/MyEclipse-Workspaces/1000/3.txt">D:\MyEclipse-Workspaces\1000\3.txt</option>
  		</select>
  		<br><input type="submit" name="submit" value="提交你的选择"> 
  	</form>
```

```
  	<%
  		String filepath=request.getParameter("filePath");
  		String fileName=filepath.substring(filepath.indexOf("/")+1);
  		response.setHeader("Content-disposition", "attachment;filename="+fileName);
  		try{
  			File f=new File(filepath);
  			FileInputStream in=new FileInputStream(f);
  			OutputStream o=response.getOutputStream();
  			int n=0;
  			byte b[]=new byte[1000];
  			while((n=in.read(b))!=-1)
  				o.write(b, 0, n);
  			o.close();
  			in.close();
  		}catch(Exception e){
  			
  		}
  	 %>
```

注册

```
	public void init(ServletConfig config) throws ServletException {
		try{
			Class.forName("com.mysql.cj.jdbc.Driver");
		}catch (Exception e) {
		}
	}
	
		protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		Connection con;
		Statement sql;
		String username = request.getParameter("username");
		String pwd = request.getParameter("pwd");
		String url = "jdbc:mysql://127.0.0.1:3308/test?serverTimezone=UTC";
		try {
			con = DriverManager.getConnection(url, "root", "12345678");
			String condition = "select * from user where username='"+username+"' and pwd='"+pwd+"'";
			sql = con.createStatement();
			ResultSet rs=sql.executeQuery(condition);
            boolean m=rs.next();
            if(m==true){
            	response.setContentType("text/html;charset=utf-8");
				response.getWriter().write("ok");
            }
		} catch (Exception e) {			
			response.setContentType("text/html;charset=utf-8");
			response.getWriter().write(e.getMessage());
		}
	}
```

登录

```
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {		
		
		String url = "jdbc:mysql://127.0.0.1:3308/test?serverTimezone=UTC&useSSL=false";		
		try {
			Connection con = DriverManager.getConnection(url, "root", "12345678");
			
			String username = req.getParameter("username");
			String pwd = req.getParameter("pwd");
			String condition = "insert into user values(?,?)";
			PreparedStatement sql = con.prepareStatement(condition);
			sql.setString(1, username);
			sql.setString(2, pwd);
			
			boolean result = sql.execute();
			if(!result){
				resp.setContentType("text/html;charset=utf-8");
				resp.getWriter().write("ok");
			}
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
	
		}
					
	}
```

